<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5. Spatial morphers • sfnetworks</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="5. Spatial morphers">
<meta property="og:description" content="sfnetworks">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfnetworks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/structure.html">1. The sfnetwork data structure</a>
    </li>
    <li>
      <a href="../articles/preprocess_and_clean.html">2. Network pre-processing and cleaning</a>
    </li>
    <li>
      <a href="../articles/join_filter.html">3. Spatial joins and filters</a>
    </li>
    <li>
      <a href="../articles/routing.html">4. Routing</a>
    </li>
    <li>
      <a href="../articles/morphers.html">5. Spatial morphers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/luukvdmeer/sfnetworks/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="morphers_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>5. Spatial morphers</h1>
            
            <h4 class="date">2021-01-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/luukvdmeer/sfnetworks/blob/master/vignettes/morphers.Rmd"><code>vignettes/morphers.Rmd</code></a></small>
      <div class="hidden name"><code>morphers.Rmd</code></div>

    </div>

    
    
<style type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>In some of the previous vignettes they were already mentioned here and there: spatial morpher functions. This vignette describes in more detail what they are and how to use them.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://luukvdmeer.github.io/sfnetworks/">sfnetworks</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com">tidygraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span></code></pre></div>
<div id="morphing-and-unmorphing" class="section level2">
<h2 class="hasAnchor">
<a href="#morphing-and-unmorphing" class="anchor"></a>Morphing and unmorphing</h2>
<p><em>Morphing</em> networks is a functionality that has its roots in <code>tidygraph</code>. It allows you to <em>temporarily</em> change the topology of the original network with the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">tidygraph::morph()</a></code> verb, perform some actions on this “morphed state” of the network using <code>dplyr</code> verbs, and finally merge the changes back into the original network with the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">tidygraph::unmorph()</a></code> verb. How the topology is changed during morphing depends on the used <em>morpher function</em>, which you provide to <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">tidygraph::morph()</a></code>.</p>
<p>You can choose between a wide range of available <em>morpher functions</em> in <code>tidygraph</code>. The names of these functions all start with <code>to_</code>. The <code>sfnetworks</code> package adds a set of dedicated <em>spatial morphers</em>, having names starting with <code>to_spatial_</code>. They will be presented later in this vignette. Lets first show a practical example to get a better idea of how morphing can be useful.</p>
<p>In network analysis, community detection algorithms allow you to discover cohesive groups in networks, based on specific network properties. There is a large offer of (wrappers around) such algorithms in <code>tidygraph</code>, see <a href="https://tidygraph.data-imaginist.com/reference/group_graph.html">here</a>. Most of them are intended for and can only be applied to the nodes. For example, the often used <a href="https://en.wikipedia.org/wiki/Louvain_method">Louvain algorithm</a>, that seeks to optimize <a href="https://en.wikipedia.org/wiki/Modularity_(networks)">modularity</a> of the partition.</p>
<p>But what if we want to detect communities within <em>edges</em>? Then, the <code><a href="https://tidygraph.data-imaginist.com/reference/morphers.html">tidygraph::to_linegraph()</a></code> morpher comes in handy. It converts a network into its linegraph, where nodes become edges and edges become nodes. That is, we can morph the network into its linegraph, run the community detection algorithm on the <em>nodes</em> of the morphed state, attach to each node information about the group it is assigned to, and automatically merge those changes back into the <em>edges</em> of the original network.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span><span class="op">(</span><span class="va">roxel</span>, directed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fl">3035</span><span class="op">)</span>

<span class="va">grouped_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">to_linegraph</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/group_graph.html">group_louvain</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">grouped_net</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 1 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 6</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name          type                                  geometry group
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>         </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                         </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker … residen…    (4151491 3207923, 4151474 3207946)    10
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee  seconda… (4151398 3207777, 4151390 3207727, 4…     3
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bern… residen… (4151408 3207539, 4151417 3207573, 4…     3
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The algorithm detected 34 communities.</span>
<span class="va">grouped_net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 34</span></code></pre></div>
<p>In all grouping functions in <code>tidygraph</code>, the group index <code>1</code> belongs the largest group, the index <code>2</code> to the second largest group, et cetera. Lets plot only the first third of the 34 groups, to keep the plot clear.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"edges"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>

<span class="va">grouped_net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="morphers_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<p>Another application of the <code><a href="https://tidygraph.data-imaginist.com/reference/morphers.html">tidygraph::to_linegraph()</a></code> morpher is to find “cut edges” in the network. These are edges that break the connectivity of a connected component when they are removed. Hence, they have a crucial function in preserving the connectivity of a network.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>is_cut <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/node_types.html">node_is_cut</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">to_linegraph</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>is_cut <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/node_types.html">node_is_cut</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">cut_nodes</span> <span class="op">=</span> <span class="va">new_net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">is_cut</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">cut_edges</span> <span class="op">=</span> <span class="va">new_net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">is_cut</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">net</span>, main <span class="op">=</span> <span class="st">"Cut nodes"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">cut_nodes</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">net</span>, main <span class="op">=</span> <span class="st">"Cut edges"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">cut_edges</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="morphers_files/figure-html/unnamed-chunk-4-1.png" width="50%"><img src="morphers_files/figure-html/unnamed-chunk-4-2.png" width="50%"></p>
<p>Internally, a morphed state of a network is a list, in which each element is a network on its own. Some morphers create a list with only a single element, like the linegraph example above, while others create a list with multiple elements. For example, the <code><a href="https://tidygraph.data-imaginist.com/reference/morphers.html">tidygraph::to_components()</a></code> morpher splits the original network into its unconnected components, storing each component as a separate network in the list.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">morphed_net</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">to_components</span><span class="op">)</span>

<span class="va">morphed_net</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork temporarily morphed to a components representation 
#&gt; #  
#&gt; # Original graph is an undirected multigraph with 14 components 
#&gt; # consisting of 701 nodes and 851 edges 
#&gt; # with CRS EPSG:3035 
#&gt; </span><span>
</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">morphed_net</span><span class="op">)</span>
<span class="co">#&gt; [1] "morphed_sfnetwork" "morphed_tbl_graph" "list"</span>

<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">morphed_net</span><span class="op">)</span>
<span class="co">#&gt; [1] 14</span></code></pre></div>
<p>All dplyr verbs for which a tbl_graph method exists can also be applied to a morphed state. Technically, that means that the same operation is applied to each element in the list. In <code>sfnetworks</code>, it is also possible to use <code><a href="https://r-spatial.github.io/sf/reference/st_join.html">sf::st_join()</a></code> and <code><a href="https://r-spatial.github.io/sf/reference/st_join.html">sf::st_filter()</a></code> on morphed states of networks.</p>
<p>The mapping back to the original network is stored in <em>.tidygraph_node_index</em> and <em>.tidygraph_edge_index</em> columns, for nodes and edges respectively. These columns contain the indices (i.e. rownumber) of the original nodes and edges. During unmorphing these indices are used to join the changes made in the morphed state back into the original network. A <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::left_join()</a></code> semantic is applied here. That means that the network has the <em>same</em> number of nodes and edges after unmorphing as it had before morphing, no matter if either the morpher function or the subsequent operations on the morphed state added or removed any nodes or edges. Whenever an original node or edge index occurs more than once in a morphed state, only the information added to its first instance is merged back into the original network.</p>
</div>
<div id="converting" class="section level2">
<h2 class="hasAnchor">
<a href="#converting" class="anchor"></a>Converting</h2>
<p>Morphing is meant to make <em>temporary</em> changes to your network. However, what if you want to make <em>lasting</em> changes? Good news! The <em>same</em> morpher functions that are used for temporary conversions during morphing can be used for lasting conversions when you provide them to the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">tidygraph::convert()</a></code> verb instead. In that case, the morphed state of the original network will be returned as a new network itself. This is mainly meant for those morpher functions that produce a morphed state with a <em>single</em> element. For example converting the network into its complement, where nodes are connected only if they were not connected in the original graph.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">to_complement</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">244503</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected simple graph with 1 component with spatially implicit edges
#&gt; #
#&gt; # Node Data:     701 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry .tidygraph_node_index
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)                     1
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)                     2
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)                     3
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)                     4
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)                     5
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)                     6
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data: 244,503 x 2</span><span>
#&gt;    from    to
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1   701
#&gt; </span><span style="color: #555555;">2</span><span>     1   700
#&gt; </span><span style="color: #555555;">3</span><span>     1   699
#&gt; </span><span style="color: #555555;"># … with 244,500 more rows</span><span>
</span></code></pre>
<p>The internally created <em>.tidygraph_node_index</em> and/or <em>.tidygraph_edge_index</em> columns are present in the network returned by <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">tidygraph::convert()</a></code>. If you rather don’t have that, set <code>.clean = TRUE</code>.</p>
<p>Whenever the morphed state consists of <em>multiple</em> elements, only one of them is returned as the new network. By default that is the first one, but you can pick an element yourself by setting the <code>.select</code> argument, e.g. <code>.select = 2</code>.</p>
</div>
<div id="spatial-morphers" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-morphers" class="anchor"></a>Spatial morphers</h2>
<p>A lot of morpher functions are offered by <code>tidygraph</code>. See the overview of them <a href="https://tidygraph.data-imaginist.com/reference/morphers.html">here</a>. Most of them should work without problems on sfnetworks, and can be useful for spatial network analysis. On top of that offer, <code>sfnetworks</code> adds some additional <em>spatial morphers</em> that fit use-cases for which <code>tidygraph</code> does not have an implemented morpher function. See the overview of them <a href="https://luukvdmeer.github.io/sfnetworks/reference/spatial_morphers.html">here</a>. Below they will all be shortly introduced.</p>
<div id="to_spatial_directed" class="section level3">
<h3 class="hasAnchor">
<a href="#to_spatial_directed" class="anchor"></a>to_spatial_directed</h3>
<p>The <code><a href="../reference/spatial_morphers.html">to_spatial_directed()</a></code> morpher turns an undirected network into a directed one based on the direction given by the linestring geometries of the edges. Hence, from the node corresponding to the first point of the linestring, to the node corresponding to the last point of the linestring. This in contradiction to <code><a href="https://tidygraph.data-imaginist.com/reference/morphers.html">tidygraph::to_directed()</a></code>, which bases the direction on the node indices given in the <em>to</em> and <em>from</em> columns of the edges. In undirected networks the lowest node index is always used as <em>from</em> index, no matter the order of endpoints in the edges’ linestring geometry. Therefore, the <em>from</em> and <em>to</em> node indices of an edge may not always correspond to the first and last endpoint of the linestring geometry, and <code><a href="../reference/spatial_morphers.html">to_spatial_directed()</a></code> gives different results as <code><a href="https://tidygraph.data-imaginist.com/reference/morphers.html">tidygraph::to_directed()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bc_undir <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_betweenness</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">to_spatial_directed</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bc_dir <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/centrality.html">centrality_betweenness</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>bc_diff <span class="op">=</span> <span class="va">bc_dir</span> <span class="op">-</span> <span class="va">bc_undir</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">bc_diff</span>, <span class="fu">desc</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 4 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry bc_undir bc_dir bc_diff
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151721 3206809)   </span><span style="text-decoration: underline;">39</span><span>283.  </span><span style="text-decoration: underline;">7</span><span>596  -</span><span style="color: #BB0000;text-decoration: underline;">31</span><span style="color: #BB0000;">687.</span><span>
#&gt; </span><span style="color: #555555;">2</span><span> (4151732 3207017)   </span><span style="text-decoration: underline;">33</span><span>800.  </span><span style="text-decoration: underline;">4</span><span>376. -</span><span style="color: #BB0000;text-decoration: underline;">29</span><span style="color: #BB0000;">424.</span><span>
#&gt; </span><span style="color: #555555;">3</span><span> (4151702 3207456)   </span><span style="text-decoration: underline;">70</span><span>243. </span><span style="text-decoration: underline;">42</span><span>322. -</span><span style="color: #BB0000;text-decoration: underline;">27</span><span style="color: #BB0000;">920.</span><span>
#&gt; </span><span style="color: #555555;">4</span><span> (4151771 3207186)   </span><span style="text-decoration: underline;">45</span><span>365. </span><span style="text-decoration: underline;">18</span><span>909. -</span><span style="color: #BB0000;text-decoration: underline;">26</span><span style="color: #BB0000;">456.</span><span>
#&gt; </span><span style="color: #555555;">5</span><span> (4151599 3207942)   </span><span style="text-decoration: underline;">30</span><span>698.  </span><span style="text-decoration: underline;">4</span><span>908  -</span><span style="color: #BB0000;text-decoration: underline;">25</span><span style="color: #BB0000;">790.</span><span>
#&gt; </span><span style="color: #555555;">6</span><span> (4151617 3207870)   </span><span style="text-decoration: underline;">30</span><span>574.  </span><span style="text-decoration: underline;">5</span><span>254  -</span><span style="color: #BB0000;text-decoration: underline;">25</span><span style="color: #BB0000;">320.</span><span>
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 5</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name            type                                      geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                             </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>   202   536 Havixbecker St… resident…       (4151491 3207923, 4151474 3207946)
#&gt; </span><span style="color: #555555;">2</span><span>    14    96 Pienersallee    secondary (4151398 3207777, 4151390 3207727, 4151…
#&gt; </span><span style="color: #555555;">3</span><span>    38    95 Schulte-Bernd-… resident… (4151408 3207539, 4151417 3207573, 4151…
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
</div>
<div id="to_spatial_explicit" class="section level3">
<h3 class="hasAnchor">
<a href="#to_spatial_explicit" class="anchor"></a>to_spatial_explicit</h3>
<p>If your original network is <em>spatially implicit</em> (i.e. edges do not have a geometry list column), the <code><a href="../reference/spatial_morphers.html">to_spatial_explicit()</a></code> morpher explicitizes the edges by creating a geometry list column for them. If the edges table can be directly converted to an sf object using <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code>, extra arguments can be provided as <code>...</code>, which will be forwarded to <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">sf::st_as_sf()</a></code> internally. Otherwise, straight lines will be drawn between the end nodes of each edge. The morphed state contains a single sfnetwork.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">implicit_net</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_set_geometry</a></span><span class="op">(</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"edges"</span><span class="op">)</span>, <span class="cn">NULL</span><span class="op">)</span>
<span class="va">explicit_net</span> <span class="op">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span><span class="va">implicit_net</span>, <span class="va">to_spatial_explicit</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">implicit_net</span>, draw_lines <span class="op">=</span> <span class="cn">FALSE</span>, main <span class="op">=</span> <span class="st">"Implicit edges"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">explicit_net</span>, main <span class="op">=</span> <span class="st">"Explicit edges"</span><span class="op">)</span></code></pre></div>
<p><img src="morphers_files/figure-html/unnamed-chunk-8-1.png" width="50%"><img src="morphers_files/figure-html/unnamed-chunk-8-2.png" width="50%"></p>
</div>
<div id="to_spatial_shortest_paths" class="section level3">
<h3 class="hasAnchor">
<a href="#to_spatial_shortest_paths" class="anchor"></a>to_spatial_shortest_paths</h3>
<p>The <code>to_spatial_shortest_paths</code> morpher limits the original network to those nodes and edges that are part of the shortest path between two nodes. Just as with the other shortest path calculation functionalities presented in the <a href="https://luukvdmeer.github.io/sfnetworks/articles/routing.html">Routing</a> vignette, besides node indices or names, any geospatial point (as sf or sfc object) can be provided as <em>from</em> and <em>to</em> node. Internally, such points will be snapped to their nearest node before calculating the shortest path.</p>
<p>The morpher only accepts a single <em>from</em> node. If also a single <em>to</em> node is provided, the morphed state of the network contains a single sfnetwork. However, it is also possible to provide multiple <em>to</em> nodes. Then, the morphed state of the network contains multiple sfnetworks, one for each from-to combination.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span><span class="op">(</span>
    <span class="va">to_spatial_shortest_paths</span>,
    from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">100</span>,
    weights <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">26</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">25</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An unrooted tree with spatially explicit edges
#&gt; #
#&gt; # Edge Data:     25 x 6 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4151193 ymin: 3207076 xmax: 4151531 ymax: 3207923</span><span>
#&gt;    from    to name      type                          geometry .tidygraph_edge_…
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>             </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     2     3 Pienersa… second… (4151398 3207777, 4151390 320…                 2
#&gt; </span><span style="color: #555555;">2</span><span>     6     7 Wilhelm-… reside… (4151350 3207279, 4151312 320…                20
#&gt; </span><span style="color: #555555;">3</span><span>     9    11 </span><span style="color: #BB0000;">NA</span><span>        path    (4151322 3207076, 4151324 320…                96
#&gt; </span><span style="color: #555555;">4</span><span>    11    12 </span><span style="color: #BB0000;">NA</span><span>        path    (4151324 3207081, 4151325 320…                97
#&gt; </span><span style="color: #555555;">5</span><span>    13    14 Am Mecke… reside… (4151323 3207085, 4151345 320…               107
#&gt; </span><span style="color: #555555;">6</span><span>     8    10 Pienersa… second… (4151340 3207612, 4151337 320…               115
#&gt; </span><span style="color: #555555;"># … with 19 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     26 x 2</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4151193 ymin: 3207076 xmax: 4151531 ymax: 3207923</span><span>
#&gt;            geometry .tidygraph_node_index
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)                     1
#&gt; </span><span style="color: #555555;">2</span><span> (4151398 3207777)                     3
#&gt; </span><span style="color: #555555;">3</span><span> (4151370 3207673)                     4
#&gt; </span><span style="color: #555555;"># … with 23 more rows</span><span>
</span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span>
    <span class="va">to_spatial_shortest_paths</span>,
    from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span>,
    weights <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>in_paths <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">new_net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">new_net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">in_paths</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">4</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="morphers_files/figure-html/unnamed-chunk-10-1.png" width="480"></p>
</div>
<div id="to_spatial_simple" class="section level3">
<h3 class="hasAnchor">
<a href="#to_spatial_simple" class="anchor"></a>to_spatial_simple</h3>
<p>The <code><a href="../reference/spatial_morphers.html">to_spatial_simple()</a></code> morpher removes loop edges and parallel edges from the original network. The morphed state contains a single sfnetwork. See the <a href="https://luukvdmeer.github.io/sfnetworks/articles/preprocess_and_clean.html#simplify-network">Network pre-processing and cleaning</a> vignette for more details.</p>
</div>
<div id="to_spatial_smooth" class="section level3">
<h3 class="hasAnchor">
<a href="#to_spatial_smooth" class="anchor"></a>to_spatial_smooth</h3>
<p>The <code><a href="../reference/spatial_morphers.html">to_spatial_smooth()</a></code> morpher creates a smoothed version of the original network by iteratively removing pseudo nodes. In the case of directed networks, pseudo nodes are those nodes that have only one incoming and one outgoing edge. In undirected networks, pseudo nodes are those nodes that have two incident edges. Connectivity of the network is preserved by concatenating the incident edges of each removed pseudo node. The morphed state contains a single sfnetwork. See the <a href="https://luukvdmeer.github.io/sfnetworks/articles/preprocess_and_clean.html#smooth-pseudo-nodes">Network pre-processing and cleaning</a> vignette for more details.</p>
</div>
<div id="to_spatial_subdivision" class="section level3">
<h3 class="hasAnchor">
<a href="#to_spatial_subdivision" class="anchor"></a>to_spatial_subdivision</h3>
<p>The <code><a href="../reference/spatial_morphers.html">to_spatial_subdivision()</a></code> morpher creates a subdivision of the original network by subdividing edges at each interior point that is equal to any other interior or boundary point of other edges. Interior points in this sense are those points that are included in a linestring geometry feature but are not endpoints of it, while boundary points are the endpoints of the linestrings. The network is reconstructed after subdivision such that connections are created at the points of subdivision. The morphed state contains a single sfnetwork. See the <a href="https://luukvdmeer.github.io/sfnetworks/articles/preprocess_and_clean.html#subdivide-edges">Network pre-processing and cleaning</a> vignette for more details.</p>
</div>
<div id="to_spatial_subset" class="section level3">
<h3 class="hasAnchor">
<a href="#to_spatial_subset" class="anchor"></a>to_spatial_subset</h3>
<p>The <code><a href="../reference/spatial_morphers.html">to_spatial_subset()</a></code> morpher takes a subset of the network by applying a spatial filter. A spatial filter is a filter on a geometry list column based on a spatial predicate. The morphed state contains a single sfnetwork. We can use this for example to spatially join information <em>only</em> to a spatial subset of the nodes in the network. A tiny example just to get an idea of how this would work:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">codes</span> <span class="op">=</span> <span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>post_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1000</span> <span class="op">+</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">-</span> <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="va">points</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">net</span>, <span class="st">"nodes"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>

<span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">to_spatial_subset</span>, <span class="va">points</span>, .pred <span class="op">=</span> <span class="va">st_equals</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">codes</span>, join <span class="op">=</span> <span class="va">st_intersects</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Subsetting by nodes</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry post_code
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)        </span><span style="color: #BB0000;">NA</span><span>
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)      </span><span style="text-decoration: underline;">1</span><span>020
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)      </span><span style="text-decoration: underline;">1</span><span>020
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)        </span><span style="color: #BB0000;">NA</span><span>
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)        </span><span style="color: #BB0000;">NA</span><span>
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)        </span><span style="color: #BB0000;">NA</span><span>
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 5</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name            type                                      geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                             </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker St… resident…       (4151491 3207923, 4151474 3207946)
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee    secondary (4151398 3207777, 4151390 3207727, 4151…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd-… resident… (4151408 3207539, 4151417 3207573, 4151…
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
<p>If you want to apply the spatial filter to the edges instead of the nodes, either activate edges before morphing, or set <code>subset_by = "edges"</code>.</p>
<p>For filters on attribute columns, use <code><a href="https://tidygraph.data-imaginist.com/reference/morphers.html">tidygraph::to_subgraph()</a></code> instead. Again, a tiny fictional example just to get an idea of how this would work:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">net</span> <span class="op">=</span> <span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>building <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">to_subgraph</span>, <span class="va">building</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_join</a></span><span class="op">(</span><span class="va">codes</span>, join <span class="op">=</span> <span class="va">st_intersects</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Subsetting by nodes</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 3 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry building post_code
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>        </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923) TRUE          </span><span style="text-decoration: underline;">1</span><span>020
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946) TRUE          </span><span style="text-decoration: underline;">1</span><span>020
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777) TRUE          </span><span style="text-decoration: underline;">1</span><span>020
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673) FALSE           </span><span style="color: #BB0000;">NA</span><span>
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539) FALSE           </span><span style="color: #BB0000;">NA</span><span>
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592) FALSE           </span><span style="color: #BB0000;">NA</span><span>
#&gt; </span><span style="color: #555555;"># … with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 5</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name            type                                      geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                             </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker St… resident…       (4151491 3207923, 4151474 3207946)
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee    secondary (4151398 3207777, 4151390 3207727, 4151…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd-… resident… (4151408 3207539, 4151417 3207573, 4151…
#&gt; </span><span style="color: #555555;"># … with 848 more rows</span><span>
</span></code></pre>
</div>
<div id="to_spatial_transformed" class="section level3">
<h3 class="hasAnchor">
<a href="#to_spatial_transformed" class="anchor"></a>to_spatial_transformed</h3>
<p>The <code><a href="../reference/spatial_morphers.html">to_spatial_transformed()</a></code> morpher temporarily transforms the network into a different coordinate reference system. An example of a situation in which this can be helpful, is the usage of the spatial edge measure function <code><a href="../reference/spatial_edge_measures.html">edge_azimuth()</a></code>. This function calculates the azimuth (or <em>bearing</em>) of edge linestrings, but requires a geographic CRS for that.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Azimuth calculation fails with our projected CRS.</span>
<span class="co"># The function complains the coordinates are not longitude/latitude.</span>
<span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>azimuth <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_azimuth</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-error"><code>#&gt; Error: Problem with `mutate()` input `azimuth`.
#&gt; <span style="color: #BB0000;">✖</span><span> st_is_longlat(x) is not TRUE
#&gt; </span><span style="color: #0000BB;">ℹ</span><span> Input `azimuth` is `edge_azimuth()`.
</span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># We make it work by temporarily transforming to a different CRS.</span>
<span class="va">net</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span><span class="op">(</span><span class="st">"edges"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span><span class="op">(</span><span class="va">to_spatial_transformed</span>, <span class="fl">4326</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>azimuth <span class="op">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_azimuth</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 6 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name       type                                  geometry  azimuth
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>      </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                         </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>    </span><span style="color: #555555;">[rad]</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbeck… reside…     (4151491 3207923, 4151474 3207946) -0.6700…
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersal… second… (4151398 3207777, 4151390 3207727, 41… -2.9135…
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-B… reside… (4151408 3207539, 4151417 3207573, 41…  0.2032…
#&gt; </span><span style="color: #555555;">4</span><span>     7     8 </span><span style="color: #BB0000;">NA</span><span>         path    (4151885 3206698, 4151861 3206711, 41… -0.9676…
#&gt; </span><span style="color: #555555;">5</span><span>     9    10 Welsinghe… reside…     (4151732 3207017, 4151721 3206809) -3.1221…
#&gt; </span><span style="color: #555555;">6</span><span>    11    12 </span><span style="color: #BB0000;">NA</span><span>         footway (4152152 3206984, 4152143 3206932, 41… -3.0971…
#&gt; </span><span style="color: #555555;"># … with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 2</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry building
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>   
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923) TRUE    
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946) TRUE    
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777) TRUE    
#&gt; </span><span style="color: #555555;"># … with 698 more rows</span><span>
</span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
