<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute a cost matrix of a spatial network — st_network_cost • sfnetworks</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compute a cost matrix of a spatial network — st_network_cost" />
<meta property="og:description" content="Wrapper around distances to calculate costs of
pairwise shortest paths between points in a spatial network. It allows to
provide any set of geospatial point as from and to arguments.
If such a geospatial point is not equal to a node in the network, it will
be snapped to its nearest node before calculating costs." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfnetworks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/structure.html">1. The sfnetwork data structure</a>
    </li>
    <li>
      <a href="../articles/preprocess_and_clean.html">2. Network pre-processing and cleaning</a>
    </li>
    <li>
      <a href="../articles/join_filter.html">3. Spatial joins and filters</a>
    </li>
    <li>
      <a href="../articles/routing.html">4. Routing</a>
    </li>
    <li>
      <a href="../articles/morphers.html">5. Spatial morphers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/luukvdmeer/sfnetworks/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute a cost matrix of a spatial network</h1>
    <small class="dont-index">Source: <a href='https://github.com/luukvdmeer/sfnetworks/blob/master/R/paths.R'><code>R/paths.R</code></a></small>
    <div class="hidden name"><code>st_network_cost.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Wrapper around <code><a href='https://rdrr.io/pkg/igraph/man/distances.html'>distances</a></code> to calculate costs of
pairwise shortest paths between points in a spatial network. It allows to
provide any set of geospatial point as <code>from</code> and <code>to</code> arguments.
If such a geospatial point is not equal to a node in the network, it will
be snapped to its nearest node before calculating costs.</p>
    </div>

    <pre class="usage"><span class='fu'>st_network_cost</span><span class='op'>(</span>
  <span class='va'>x</span>,
  from <span class='op'>=</span> <span class='fu'>igraph</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/igraph/man/V.html'>V</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>,
  to <span class='op'>=</span> <span class='fu'>igraph</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/igraph/man/V.html'>V</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>,
  weights <span class='op'>=</span> <span class='cn'>NULL</span>,
  Inf_as_NaN <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An object of class <code><a href='sfnetwork.html'>sfnetwork</a></code>.</p></td>
    </tr>
    <tr>
      <th>from</th>
      <td><p>The (set of) geospatial point(s) from which the shortest paths
will be calculated. Can be an object of  class <code><a href='https://r-spatial.github.io/sf/reference/sf.html'>sf</a></code> or
<code><a href='https://r-spatial.github.io/sf/reference/sfc.html'>sfc</a></code>.
Alternatively it can be a numeric vector containing the indices of the nodes
from which the shortest paths will be calculated, or a character vector
containing the names of the nodes from which the shortest paths will be
calculated. By default, all nodes in the network are included.</p></td>
    </tr>
    <tr>
      <th>to</th>
      <td><p>The (set of) geospatial point(s) to which the shortest paths will
be calculated. Can be an object of  class <code><a href='https://r-spatial.github.io/sf/reference/sf.html'>sf</a></code> or
<code><a href='https://r-spatial.github.io/sf/reference/sfc.html'>sfc</a></code>. Features with duplicated nearest node indices will be
removed before calculating the cost matrix.
Alternatively it can be a numeric vector containing the indices of the nodes
to which the shortest paths will be calculated, or a character vector
containing the names of the nodes to which the shortest paths will be
calculated. Duplicated values will be removed before calculating the cost
matrix. By default, all nodes in the network are included.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>The edge weights to be used in the shortest path calculation.
Can be a numeric vector giving edge weights, or a column name referring to
an attribute column in the edges table containing those weights. If set to
<code>NULL</code>, the values of a column named <code>weight</code> in the edges table
will be used automatically, as long as this column is present. If not, the
geographic edge lengths will be calculated internally and used as weights.
If set to <code>NA</code>, no weights are used, even if the edges have a
<code>weight</code> column.</p></td>
    </tr>
    <tr>
      <th>Inf_as_NaN</th>
      <td><p>Should the cost values of unconnected nodes be stored as
<code>NaN</code> instead of <code>Inf</code>? Defaults to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments passed on to <code><a href='https://rdrr.io/pkg/igraph/man/distances.html'>distances</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An n times m numeric matrix where n is the length of the <code>from</code>
argument, and m is the length of unique values in the <code>to</code> argument.
When the <code>to</code> argument contains spatial features that have the same
nearest node, these features are considered duplicates.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Spatial features provided to the <code>from</code> and/or
<code>to</code> argument don't necessarily have to be points. Internally, the
nearest node to each feature is found by calling
<code><a href='https://r-spatial.github.io/sf/reference/st_nearest_feature.html'>st_nearest_feature</a></code>, so any feature with a geometry type
that is accepted by that function can be provided as <code>from</code> and/or
<code>to</code> argument.</p>
<p>When directly providing integer node indices or character node names to the
<code>from</code> and/or <code>to</code> argument, keep the following in mind. A node
index should correspond to a row-number of the nodes table of the network.
A node name should correspond to a value of a column in the nodes table
named <code>name</code>. This column should contain character values without
duplicates.</p>
<p>For more details on the wrapped function from <code><a href='https://rdrr.io/pkg/igraph/man/aaa-igraph-package.html'>igraph</a></code>
see the <code><a href='https://rdrr.io/pkg/igraph/man/distances.html'>distances</a></code> documentation page.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>By default, <code><a href='https://rdrr.io/pkg/igraph/man/distances.html'>distances</a></code> calculates costs by
by allowing to travel each edge in both directions, hence by assuming an
undirected network. This is the default even when the input network is
directed! For directed networks, the behaviour can be changed by setting
<code>mode = "out"</code> to consider only outbound edges, or <code>mode = "in"</code>
to consider only inbound edges.</p>
<p>Furthermore, <code><a href='https://rdrr.io/pkg/igraph/man/distances.html'>distances</a></code> does not allow duplicated
values in the <code>to</code> argument. This also means that when providing
spatial features, sets of multiple features that happen to have the same
nearest node will be reduced to one by selecting only the first of these
features.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='st_network_paths.html'>st_network_paths</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidygraph.data-imaginist.com'>tidygraph</a></span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Create a network with edge lenghts as weights.</span>
<span class='co'># These weights will be used automatically in shortest paths calculation.</span>
<span class='va'>net</span> <span class='op'>=</span> <span class='fu'><a href='as_sfnetwork.html'>as_sfnetwork</a></span><span class='op'>(</span><span class='va'>roxel</span>, directed <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_transform.html'>st_transform</a></span><span class='op'>(</span><span class='fl'>3035</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://tidygraph.data-imaginist.com/reference/activate.html'>activate</a></span><span class='op'>(</span><span class='st'>"edges"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='fu'><a href='spatial_edge_measures.html'>edge_length</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Providing node indices.</span>
<span class='fu'>st_network_cost</span><span class='op'>(</span><span class='va'>net</span>, from <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>495</span>, <span class='fl'>121</span><span class='op'>)</span>, to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>495</span>, <span class='fl'>121</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          [,1]     [,2]
#&gt; [1,]    0.000 2094.555
#&gt; [2,] 2094.555    0.000</div><div class='input'>
<span class='co'># Providing nodes as spatial points.</span>
<span class='co'># Points that don't equal a node will be snapped to their nearest node.</span>
<span class='va'>p1</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_geometry</a></span><span class='op'>(</span><span class='va'>net</span>, <span class='st'>"nodes"</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>495</span><span class='op'>]</span> <span class='op'>+</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_point</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='op'>-</span><span class='fl'>50</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>p1</span><span class='op'>)</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>net</span><span class='op'>)</span>
<span class='va'>p2</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_geometry</a></span><span class='op'>(</span><span class='va'>net</span>, <span class='st'>"nodes"</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>121</span><span class='op'>]</span> <span class='op'>+</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_point</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>10</span>, <span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>p2</span><span class='op'>)</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>net</span><span class='op'>)</span>

<span class='fu'>st_network_cost</span><span class='op'>(</span><span class='va'>net</span>, from <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>p2</span><span class='op'>)</span>, to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>p2</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          [,1]     [,2]
#&gt; [1,]    0.000 2094.555
#&gt; [2,] 2094.555    0.000</div><div class='input'>
<span class='co'># Using another column for weights.</span>
<span class='va'>net</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://tidygraph.data-imaginist.com/reference/activate.html'>activate</a></span><span class='op'>(</span><span class='st'>"edges"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>foo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>, min <span class='op'>=</span> <span class='fl'>0</span>, max <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>st_network_cost</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>p2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>p2</span><span class='op'>)</span>, weights <span class='op'>=</span> <span class='st'>"foo"</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          [,1]     [,2]
#&gt; [1,]  0.00000 10.29983
#&gt; [2,] 10.29983  0.00000</div><div class='input'>
<span class='co'># Not providing any from or to points includes all nodes by default.</span>
<span class='fu'><a href='https://tidygraph.data-imaginist.com/reference/with_graph.html'>with_graph</a></span><span class='op'>(</span><span class='va'>net</span>, <span class='fu'><a href='https://tidygraph.data-imaginist.com/reference/graph_measures.html'>graph_order</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Our network has 701 nodes.</span>
</div><div class='output co'>#&gt; [1] 701</div><div class='input'><span class='va'>cost_matrix</span> <span class='op'>=</span> <span class='fu'>st_network_cost</span><span class='op'>(</span><span class='va'>net</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>cost_matrix</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 701 701</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


