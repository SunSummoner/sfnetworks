<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Query nodes with spatial predicates — spatial_node_predicates • sfnetworks</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Query nodes with spatial predicates — spatial_node_predicates" />
<meta property="og:description" content="These functions allow to interpret spatial relations between nodes and
other geospatial features directly inside filter
and mutate calls. All functions return a logical
vector of the same length as the number of nodes in the network. Element i
in that vector is TRUE whenever any(predicate(x[i], y[j])) is
TRUE. Hence, in the case of using node_intersects, element i
in the returned vector is TRUE when node i intersects with any of
the features given in y." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfnetworks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/structure.html">1. The sfnetwork data structure</a>
    </li>
    <li>
      <a href="../articles/preprocess_and_clean.html">2. Network pre-processing and cleaning</a>
    </li>
    <li>
      <a href="../articles/join_filter.html">3. Spatial joins and filters</a>
    </li>
    <li>
      <a href="../articles/routing.html">4. Routing</a>
    </li>
    <li>
      <a href="../articles/morphers.html">5. Spatial morphers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/luukvdmeer/sfnetworks/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Query nodes with spatial predicates</h1>
    <small class="dont-index">Source: <a href='https://github.com/luukvdmeer/sfnetworks/blob/master/R/node.R'><code>R/node.R</code></a></small>
    <div class="hidden name"><code>spatial_node_predicates.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions allow to interpret spatial relations between nodes and
other geospatial features directly inside <code><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></code>
and <code><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></code> calls. All functions return a logical
vector of the same length as the number of nodes in the network. Element i
in that vector is <code>TRUE</code> whenever <code><a href='https://rdrr.io/r/base/any.html'>any(predicate(x[i], y[j]))</a></code> is
<code>TRUE</code>. Hence, in the case of using <code>node_intersects</code>, element i
in the returned vector is <code>TRUE</code> when node i intersects with any of
the features given in y.</p>
    </div>

    <pre class="usage"><span class='fu'>node_intersects</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>node_is_disjoint</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>node_touches</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>node_is_within</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>node_equals</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>node_is_covered_by</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>node_is_within_distance</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>The geospatial features to test the nodes against, either as an
object of class <code><a href='https://r-spatial.github.io/sf/reference/sf.html'>sf</a></code> or <code><a href='https://r-spatial.github.io/sf/reference/sfc.html'>sfc</a></code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments passed on to the corresponding spatial predicate
function of sf. See <code><a href='https://r-spatial.github.io/sf/reference/geos_binary_pred.html'>geos_binary_pred</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A logical vector of the same length as the number of nodes in the
network.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>See <code><a href='https://r-spatial.github.io/sf/reference/geos_binary_pred.html'>geos_binary_pred</a></code> for details on each spatial
predicate. Just as with all query functions in tidygraph, these functions
are meant to be called inside tidygraph verbs such as
<code><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></code> or <code><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></code>, where
the network that is currently being worked on is known and thus not needed
as an argument to the function. If you want to use an algorithm outside of
the tidygraph framework you can use <code><a href='https://tidygraph.data-imaginist.com/reference/with_graph.html'>with_graph</a></code> to
set the context temporarily while the algorithm is being evaluated.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Note that <code>node_is_within_distance</code> is a wrapper around the
<code>st_is_within_distance</code> predicate from sf. Hence, it is based on
'as-the-crow-flies' distance, and not on distances over the network. For
distances over the network, use <code><a href='https://tidygraph.data-imaginist.com/reference/pair_measures.html'>node_distance_to</a></code>
with edge lengths as weights argument.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidygraph.data-imaginist.com'>tidygraph</a></span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Create a network.</span>
<span class='va'>net</span> <span class='op'>=</span> <span class='fu'><a href='as_sfnetwork.html'>as_sfnetwork</a></span><span class='op'>(</span><span class='va'>roxel</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_transform.html'>st_transform</a></span><span class='op'>(</span><span class='fl'>3035</span><span class='op'>)</span>

<span class='co'># Create a geometry to test against.</span>
<span class='va'>p1</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_point</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4151358</span>, <span class='fl'>3208045</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>p2</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_point</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4151340</span>, <span class='fl'>3207520</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>p3</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_point</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4151756</span>, <span class='fl'>3207506</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>p4</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_point</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4151774</span>, <span class='fl'>3208031</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>poly</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_multipoint</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p1</span>, <span class='va'>p2</span>, <span class='va'>p3</span>, <span class='va'>p4</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_cast.html'>st_cast</a></span><span class='op'>(</span><span class='st'>'POLYGON'</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='fl'>3035</span><span class='op'>)</span>

<span class='co'># Use predicate query function in a filter call.</span>
<span class='va'>within</span> <span class='op'>=</span> <span class='va'>net</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://tidygraph.data-imaginist.com/reference/activate.html'>activate</a></span><span class='op'>(</span><span class='st'>"nodes"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>node_is_within</span><span class='op'>(</span><span class='va'>poly</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>disjoint</span> <span class='op'>=</span> <span class='va'>net</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://tidygraph.data-imaginist.com/reference/activate.html'>activate</a></span><span class='op'>(</span><span class='st'>"nodes"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'>node_is_disjoint</span><span class='op'>(</span><span class='va'>poly</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>oldpar</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>no.readonly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mar <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://r-spatial.github.io/sf/reference/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>net</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://r-spatial.github.io/sf/reference/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>within</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://r-spatial.github.io/sf/reference/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>disjoint</span>, col <span class='op'>=</span> <span class='st'>"blue"</span>, add <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='img'><img src='spatial_node_predicates-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span><span class='va'>oldpar</span><span class='op'>)</span>

<span class='co'># Use predicate query function in a mutate call.</span>
<span class='va'>net</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://tidygraph.data-imaginist.com/reference/activate.html'>activate</a></span><span class='op'>(</span><span class='st'>"nodes"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>within <span class='op'>=</span> <span class='fu'>node_is_within</span><span class='op'>(</span><span class='va'>poly</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>within</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #555555;'># A sfnetwork with</span><span> </span><span style='color: #555555;'>701</span><span> </span><span style='color: #555555;'>nodes and</span><span> </span><span style='color: #555555;'>851</span><span> </span><span style='color: #555555;'>edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style='color: #555555;'>EPSG:3035</span><span> </span><span style='color: #555555;'>
#&gt; #
#&gt; # A directed multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; </span><span style='color: #949494;'># Node Data:     701 x 2 (active)</span><span>
#&gt; </span><span style='color: #949494;'># Geometry type: POINT</span><span>
#&gt; </span><span style='color: #949494;'># Dimension:     XY</span><span>
#&gt; </span><span style='color: #949494;'># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;   within          geometry
#&gt;   </span><span style='color: #949494;font-style: italic;'>&lt;lgl&gt;</span><span>        </span><span style='color: #949494;font-style: italic;'>&lt;POINT [m]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'>1</span><span> TRUE   (4151491 3207923)
#&gt; </span><span style='color: #BCBCBC;'>2</span><span> TRUE   (4151474 3207946)
#&gt; </span><span style='color: #BCBCBC;'>3</span><span> TRUE   (4151398 3207777)
#&gt; </span><span style='color: #BCBCBC;'>4</span><span> TRUE   (4151370 3207673)
#&gt; </span><span style='color: #BCBCBC;'>5</span><span> TRUE   (4151408 3207539)
#&gt; </span><span style='color: #BCBCBC;'>6</span><span> TRUE   (4151421 3207592)
#&gt; </span><span style='color: #949494;'># … with 695 more rows</span><span>
#&gt; </span><span style='color: #555555;'>#
#&gt; </span><span style='color: #949494;'># Edge Data:     851 x 5</span><span>
#&gt; </span><span style='color: #949494;'># Geometry type: LINESTRING</span><span>
#&gt; </span><span style='color: #949494;'># Dimension:     XY</span><span>
#&gt; </span><span style='color: #949494;'># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name            type                                      geometry
#&gt;   </span><span style='color: #949494;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;chr&gt;</span><span>           </span><span style='color: #949494;font-style: italic;'>&lt;fct&gt;</span><span>                             </span><span style='color: #949494;font-style: italic;'>&lt;LINESTRING [m]&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'>1</span><span>     1     2 Havixbecker St… resident…       (4151491 3207923, 4151474 3207946)
#&gt; </span><span style='color: #BCBCBC;'>2</span><span>     3     4 Pienersallee    secondary (4151398 3207777, 4151390 3207727, 4151…
#&gt; </span><span style='color: #BCBCBC;'>3</span><span>     5     6 Schulte-Bernd-… resident… (4151408 3207539, 4151417 3207573, 4151…
#&gt; </span><span style='color: #949494;'># … with 848 more rows</span><span></div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


